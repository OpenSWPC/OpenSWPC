!! ----------------------------------------------------------------------------------------------------------------------------- !!
!>
!! color palette
!!
!! @copyright
!!   Copyright 2013-2021 Takuto Maeda. All rights reserved. This project is released under the MIT license.
!<
!! ----------------------------------------------------------------------------------------------------------------------------- !!
module m_color

  use m_std
  implicit none

  !! --------------------------------------------------------------------------------------------------------------------------- !!
  !>
  !! color palette
  !!
  !! v1 (R G B)  -  v2 (R G B)
  !! colors between v1 and v2 are interpolated linearly
  !<
  !! --
  type color__palette

    integer               :: nc
    real(DP), allocatable :: v1(:), v2(:)
    integer,  allocatable :: col1(:,:), col2(:,:)
    integer               :: col_b(3), col_f(3), col_n(3)
    logical               :: initialized = .false.

  end type color__palette
  !! --------------------------------------------------------------------------------------------------------------------------- !!

contains

  !! --------------------------------------------------------------------------------------------------------------------------- !!
  !>
  !! export color palette dataset as GMT cpt file to I/O number io
  !<
  !! --
  subroutine color__export_cpt( cp, io )

    type(color__palette), intent(in) :: cp
    integer,              intent(in) :: io

    integer :: i

    !! ----

    do i=1, cp%nc
      write(io,'(F12.4,3I5,A,F12.4,3I5)') cp%v1(i), cp%col1(:,i), "   ", cp%v2(i), cp%col2(:,i)
    end do

    write(io, '(A,3I5)') "B  ", cp%col_b(:)
    write(io, '(A,3I5)') "F  ", cp%col_f(:)
    write(io, '(A,3I5)') "N  ", cp%col_n(:)

  end subroutine color__export_cpt
  !! --------------------------------------------------------------------------------------------------------------------------- !!

  !! --------------------------------------------------------------------------------------------------------------------------- !!
  !>
  !! export color palette dataset as GMT cpt file to I/O number io
  !<
  !! --
  subroutine color__interpolate( cp, v, col )

    type(color__palette), intent(in)  :: cp
    real(DP),             intent(in)  :: v
    integer,              intent(out) :: col(3) ! R/G/B, 0-255
    integer :: i, j
    logical :: found
    !! ----

    !! initial
    if( v < cp%v1(1) ) then
      col(:) = cp%col_b(:)
      return
    end if


    found = .false.
    do i=1, cp%nc

      if( cp%v1(i) <= v .and. v < cp%v2(i) ) then
        do j=1, 3
          col(j) = ( cp%col2(j,i) - cp%col1(j,i) ) / ( cp%v2(i) - cp%v1(i) ) * v &
              + ( cp%col1(j,i)*cp%v2(i) - cp%col2(j,i)*cp%v1(i) ) / ( cp%v2(i) - cp%v1(i) )
          col(j) = min( max( col(j), 0 ), 255 )
        end do
        found = .true.
        exit
      end if

    end do

    if( .not. found ) col(:) = cp%col_f(:)

  end subroutine color__interpolate
  !! --------------------------------------------------------------------------------------------------------------------------- !!

  !! --------------------------------------------------------------------------------------------------------------------------- !!
  subroutine color__set( typ, cp )

    type(color__palette), intent(out) :: cp
    character(*), intent(in) :: typ

    cp%initialized = .true.

    select case ( typ )
    case ( 'mytopo' ); call cpt_mytopo
    case ( 'hot' );    call cpt_hot()
    end select

  contains
    subroutine cpt_hot

      !! generated from makecpt -Chot -I -Z

      cp%nc=3
      allocate( cp%v1(cp%nc) )
      allocate( cp%v2(cp%nc) )
      allocate( cp%col1(3,cp%nc) )
      allocate( cp%col2(3,cp%nc) )

      cp%v1(1) = 0.000000; cp%col1(:,1) = (/255,255,255/); cp%v2(1) = 0.250000; ; cp%col2(:,1) = (/255,255,0/)
      cp%v1(2) = 0.250000; cp%col1(:,2) = (/255,255,0/); cp%v2(2) = 0.625000; ; cp%col2(:,2) = (/255,0,0/)
      cp%v1(3) = 0.625000; cp%col1(:,3) = (/255,0,0/); cp%v2(3) = 1.000000; ; cp%col2(:,3) = (/0,0,0/)

      cp%col_b = (/ 255,255,255 /)
      cp%col_f = (/ 0, 0, 0 /)
      cp%col_n = (/128,128,128/)
    end subroutine cpt_hot

    subroutine cpt_mytopo

      !! original subdued color palette for topography/bathymetry
      cp%nc = 67
      allocate( cp%v1(cp%nc) )
      allocate( cp%v2(cp%nc) )
      allocate( cp%col1(3,cp%nc) )
      allocate( cp%col2(3,cp%nc) )

      cp%v1(1) = -10000.000000; cp%col1(:,1) = (/45,127,148/); cp%v2(1) = -9500.000000; ; cp%col2(:,1) = (/43,132,156/)
      cp%v1(2) = -9500.000000; cp%col1(:,2) = (/43,132,156/); cp%v2(2) = -9000.000000; ; cp%col2(:,2) = (/44,137,164/)
      cp%v1(3) = -9000.000000; cp%col1(:,3) = (/44,137,164/); cp%v2(3) = -8500.000000; ; cp%col2(:,3) = (/52,144,172/)
      cp%v1(4) = -8500.000000; cp%col1(:,4) = (/52,144,172/); cp%v2(4) = -8000.000000; ; cp%col2(:,4) = (/58,148,178/)
      cp%v1(5) = -8000.000000; cp%col1(:,5) = (/58,148,178/); cp%v2(5) = -7500.000000; ; cp%col2(:,5) = (/62,150,182/)
      cp%v1(6) = -7500.000000; cp%col1(:,6) = (/62,150,182/); cp%v2(6) = -7000.000000; ; cp%col2(:,6) = (/67,152,187/)
      cp%v1(7) = -7000.000000; cp%col1(:,7) = (/67,152,187/); cp%v2(7) = -6500.000000; ; cp%col2(:,7) = (/72,155,191/)
      cp%v1(8) = -6500.000000; cp%col1(:,8) = (/72,155,191/); cp%v2(8) = -6000.000000; ; cp%col2(:,8) = (/80,160,196/)
      cp%v1(9) = -6000.000000; cp%col1(:,9) = (/80,160,196/); cp%v2(9) = -5500.000000; ; cp%col2(:,9) = (/87,164,200/)
      cp%v1(10) = -5500.000000; cp%col1(:,10) = (/87,164,200/); cp%v2(10) = -5000.000000; ; cp%col2(:,10) = (/95,169,204/)
      cp%v1(11) = -5000.000000; cp%col1(:,11) = (/95,169,204/); cp%v2(11) = -4500.000000; ; cp%col2(:,11) = (/101,172,205/)
      cp%v1(12) = -4500.000000; cp%col1(:,12) = (/101,172,205/); cp%v2(12) = -4000.000000; ; cp%col2(:,12) = (/107,175,206/)
      cp%v1(13) = -4000.000000; cp%col1(:,13) = (/107,175,206/); cp%v2(13) = -3500.000000; ; cp%col2(:,13) = (/113,178,207/)
      cp%v1(14) = -3500.000000; cp%col1(:,14) = (/113,178,207/); cp%v2(14) = -3000.000000; ; cp%col2(:,14) = (/121,182,209/)
      cp%v1(15) = -3000.000000; cp%col1(:,15) = (/121,182,209/); cp%v2(15) = -2500.000000; ; cp%col2(:,15) = (/129,187,212/)
      cp%v1(16) = -2500.000000; cp%col1(:,16) = (/129,187,212/); cp%v2(16) = -2000.000000; ; cp%col2(:,16) = (/137,192,215/)
      cp%v1(17) = -2000.000000; cp%col1(:,17) = (/137,192,215/); cp%v2(17) = -1500.000000; ; cp%col2(:,17) = (/148,198,217/)
      cp%v1(18) = -1500.000000; cp%col1(:,18) = (/148,198,217/); cp%v2(18) = -1000.000000; ; cp%col2(:,18) = (/165,205,219/)
      cp%v1(19) = -1000.000000; cp%col1(:,19) = (/165,205,219/); cp%v2(19) = -500.000000; ; cp%col2(:,19) = (/189,222,227/)
      cp%v1(20) = -500.000000; cp%col1(:,20) = (/189,222,227/); cp%v2(20) = 0.000000; ; cp%col2(:,20) = (/226,240,241/)
      cp%v1(21) = 0.000000; cp%col1(:,21) = (/153,167,158/); cp%v2(21) = 100.000000; ; cp%col2(:,21) = (/164,181,170/)
      cp%v1(22) = 100.000000; cp%col1(:,22) = (/164,181,170/); cp%v2(22) = 200.000000; ; cp%col2(:,22) = (/172,190,177/)
      cp%v1(23) = 200.000000; cp%col1(:,23) = (/172,190,177/); cp%v2(23) = 300.000000; ; cp%col2(:,23) = (/179,197,184/)
      cp%v1(24) = 300.000000; cp%col1(:,24) = (/179,197,184/); cp%v2(24) = 400.000000; ; cp%col2(:,24) = (/186,205,192/)
      cp%v1(25) = 400.000000; cp%col1(:,25) = (/186,205,192/); cp%v2(25) = 500.000000; ; cp%col2(:,25) = (/190,209,194/)
      cp%v1(26) = 500.000000; cp%col1(:,26) = (/190,209,194/); cp%v2(26) = 600.000000; ; cp%col2(:,26) = (/194,209,195/)
      cp%v1(27) = 600.000000; cp%col1(:,27) = (/194,209,195/); cp%v2(27) = 700.000000; ; cp%col2(:,27) = (/198,210,195/)
      cp%v1(28) = 700.000000; cp%col1(:,28) = (/198,210,195/); cp%v2(28) = 800.000000; ; cp%col2(:,28) = (/202,212,196/)
      cp%v1(29) = 800.000000; cp%col1(:,29) = (/202,212,196/); cp%v2(29) = 900.000000; ; cp%col2(:,29) = (/208,213,197/)
      cp%v1(30) = 900.000000; cp%col1(:,30) = (/208,213,197/); cp%v2(30) = 1000.000000; ; cp%col2(:,30) = (/213,215,197/)
      cp%v1(31) = 1000.000000; cp%col1(:,31) = (/213,215,197/); cp%v2(31) = 1100.000000; ; cp%col2(:,31) = (/218,215,196/)
      cp%v1(32) = 1100.000000; cp%col1(:,32) = (/218,215,196/); cp%v2(32) = 1200.000000; ; cp%col2(:,32) = (/222,215,194/)
      cp%v1(33) = 1200.000000; cp%col1(:,33) = (/222,215,194/); cp%v2(33) = 1300.000000; ; cp%col2(:,33) = (/224,212,194/)
      cp%v1(34) = 1300.000000; cp%col1(:,34) = (/224,212,194/); cp%v2(34) = 1400.000000; ; cp%col2(:,34) = (/222,210,193/)
      cp%v1(35) = 1400.000000; cp%col1(:,35) = (/222,210,193/); cp%v2(35) = 1500.000000; ; cp%col2(:,35) = (/224,207,189/)
      cp%v1(36) = 1500.000000; cp%col1(:,36) = (/224,207,189/); cp%v2(36) = 1600.000000; ; cp%col2(:,36) = (/224,203,187/)
      cp%v1(37) = 1600.000000; cp%col1(:,37) = (/224,203,187/); cp%v2(37) = 1700.000000; ; cp%col2(:,37) = (/222,200,184/)
      cp%v1(38) = 1700.000000; cp%col1(:,38) = (/222,200,184/); cp%v2(38) = 1800.000000; ; cp%col2(:,38) = (/222,197,183/)
      cp%v1(39) = 1800.000000; cp%col1(:,39) = (/222,197,183/); cp%v2(39) = 1900.000000; ; cp%col2(:,39) = (/221,195,181/)
      cp%v1(40) = 1900.000000; cp%col1(:,40) = (/221,195,181/); cp%v2(40) = 2000.000000; ; cp%col2(:,40) = (/220,194,180/)
      cp%v1(41) = 2000.000000; cp%col1(:,41) = (/220,194,180/); cp%v2(41) = 2100.000000; ; cp%col2(:,41) = (/218,196,181/)
      cp%v1(42) = 2100.000000; cp%col1(:,42) = (/218,196,181/); cp%v2(42) = 2200.000000; ; cp%col2(:,42) = (/219,197,185/)
      cp%v1(43) = 2200.000000; cp%col1(:,43) = (/219,197,185/); cp%v2(43) = 2300.000000; ; cp%col2(:,43) = (/219,198,187/)
      cp%v1(44) = 2300.000000; cp%col1(:,44) = (/219,198,187/); cp%v2(44) = 2400.000000; ; cp%col2(:,44) = (/219,201,191/)
      cp%v1(45) = 2400.000000; cp%col1(:,45) = (/219,201,191/); cp%v2(45) = 2500.000000; ; cp%col2(:,45) = (/218,203,194/)
      cp%v1(46) = 2500.000000; cp%col1(:,46) = (/218,203,194/); cp%v2(46) = 2600.000000; ; cp%col2(:,46) = (/217,206,196/)
      cp%v1(47) = 2600.000000; cp%col1(:,47) = (/217,206,196/); cp%v2(47) = 2700.000000; ; cp%col2(:,47) = (/219,207,198/)
      cp%v1(48) = 2700.000000; cp%col1(:,48) = (/219,207,198/); cp%v2(48) = 2800.000000; ; cp%col2(:,48) = (/219,207,199/)
      cp%v1(49) = 2800.000000; cp%col1(:,49) = (/219,207,199/); cp%v2(49) = 2900.000000; ; cp%col2(:,49) = (/219,207,200/)
      cp%v1(50) = 2900.000000; cp%col1(:,50) = (/219,207,200/); cp%v2(50) = 3000.000000; ; cp%col2(:,50) = (/218,208,202/)
      cp%v1(51) = 3000.000000; cp%col1(:,51) = (/218,208,202/); cp%v2(51) = 3100.000000; ; cp%col2(:,51) = (/218,208,202/)
      cp%v1(52) = 3100.000000; cp%col1(:,52) = (/218,208,202/); cp%v2(52) = 3200.000000; ; cp%col2(:,52) = (/218,208,202/)
      cp%v1(53) = 3200.000000; cp%col1(:,53) = (/218,208,202/); cp%v2(53) = 3300.000000; ; cp%col2(:,53) = (/218,208,202/)
      cp%v1(54) = 3300.000000; cp%col1(:,54) = (/218,208,202/); cp%v2(54) = 3400.000000; ; cp%col2(:,54) = (/217,206,203/)
      cp%v1(55) = 3400.000000; cp%col1(:,55) = (/217,206,203/); cp%v2(55) = 3500.000000; ; cp%col2(:,55) = (/216,206,203/)
      cp%v1(56) = 3500.000000; cp%col1(:,56) = (/216,206,203/); cp%v2(56) = 3600.000000; ; cp%col2(:,56) = (/215,208,204/)
      cp%v1(57) = 3600.000000; cp%col1(:,57) = (/215,208,204/); cp%v2(57) = 3700.000000; ; cp%col2(:,57) = (/215,210,206/)
      cp%v1(58) = 3700.000000; cp%col1(:,58) = (/215,210,206/); cp%v2(58) = 3800.000000; ; cp%col2(:,58) = (/217,211,209/)
      cp%v1(59) = 3800.000000; cp%col1(:,59) = (/217,211,209/); cp%v2(59) = 3900.000000; ; cp%col2(:,59) = (/217,213,211/)
      cp%v1(60) = 3900.000000; cp%col1(:,60) = (/217,213,211/); cp%v2(60) = 4000.000000; ; cp%col2(:,60) = (/217,216,214/)
      cp%v1(61) = 4000.000000; cp%col1(:,61) = (/217,216,214/); cp%v2(61) = 4100.000000; ; cp%col2(:,61) = (/219,218,216/)
      cp%v1(62) = 4100.000000; cp%col1(:,62) = (/219,218,216/); cp%v2(62) = 4200.000000; ; cp%col2(:,62) = (/220,219,219/)
      cp%v1(63) = 4200.000000; cp%col1(:,63) = (/220,219,219/); cp%v2(63) = 4300.000000; ; cp%col2(:,63) = (/223,222,220/)
      cp%v1(64) = 4300.000000; cp%col1(:,64) = (/223,222,220/); cp%v2(64) = 4400.000000; ; cp%col2(:,64) = (/226,224,224/)
      cp%v1(65) = 4400.000000; cp%col1(:,65) = (/226,224,224/); cp%v2(65) = 4500.000000; ; cp%col2(:,65) = (/227,226,226/)
      cp%v1(66) = 4500.000000; cp%col1(:,66) = (/227,226,226/); cp%v2(66) = 4600.000000; ; cp%col2(:,66) = (/229,228,228/)
      cp%v1(67) = 4600.000000; cp%col1(:,67) = (/229,228,228/); cp%v2(67) = 4700.000000; ; cp%col2(:,67) = (/230,230,230/)


      cp%col_b = (/ 45,127,168/)
      cp%col_f = (/230,230,230/)
      cp%col_n = (/128,128,128/)
    end subroutine cpt_mytopo



  end subroutine color__set
  !! --------------------------------------------------------------------------------------------------------------------------- !!

end module m_color
!! ----------------------------------------------------------------------------------------------------------------------------- !!
