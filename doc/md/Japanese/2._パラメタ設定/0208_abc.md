# 吸収境界条件

`OpenSWPC`では，主たる吸収境界条件としてAuxiliary Differential Equation, Complex
Frequency-Shifted Perfectly Matched Layer (ADE CFS-PML; Zhang et al., 2010[^Zhang2010]）を採用している．

[^Zhang2010]: Zhang, W., and Y. Shen (2010), Unsplit complex frequency-shifted PML implementation using auxiliary differential equations for seismic wave modeling, _Geophysics_, _75_(4), T141–T154, doi:10.1190/1.3463431.

PMLとは，媒質の端点から数十グリッドを吸収（スポンジ）領域とし，微分方向に依存した減衰性媒質の時間発展方程式を解くことで効果的に人工反射を押さえる手法である．
より単純かつ伝統的なCerjanによるスポンジ条件（Cerjan et al., 1985[^Cerjan1985]）も利用できる．
境界条件の種類は入力パラメタによって切り替える．

[^Cerjan1985]: Cerjan, C., D. Kosloff, R. Kosloff, and M. Reshef (1985), A nonreflecting boundary condition for discrete acoustic and elastic wave equations, _Geophysics_, _50_(4), 705–708.

全モデル空間は吸収境界の厚さグリッド数 `na` の指定によって，図のように内部領域と外部領域に分けられる．
吸収境界はモデルの端面を覆う必要がある．
しかし，本コードにおいては地表面がある媒質での計算を前提としており，かつ空中音波は無視する（仮想的な真空状態）ため，上面の吸収条件は必要ない．
そこで，通常は深さグリッド位置`kbeg_a`より深い部分のみ，吸収境界条件を適用する．

!!! Quote "吸収境界条件の定義領域"
    ![](../../fig/absorber_region.png)
    吸収境界条件の定義領域の模式図．赤点線が`kbeg_a(I,J)`の位置を表す．


簡単のため，`OpenSWPC`ではPML領域は粘弾性を解かず，弾性体の構成方程式とPML吸収条件を組み合わせる．
このことにより計算メモリを節約できる上，吸収境界と内部領域との間での計算負荷のバランスを改善することができる．
しかし，Q値が極端に小さな媒質の場合，内部領域での物理分散による速度低下が無視できなくなる．
この場合，吸収境界内と内部領域とで物理分散の有無に伴う速度コントラストが発生し，それに伴う人工反射波が生ずることがある．
速度均質媒質のシミュレーションスナップショットなどから反射波生成の度合いを確認し，それが許容範囲であるかあらかじめ調査することが望ましい．

Cerjanによる吸収境界条件については，Cerjan (1985)[^Cerjan1985]で提案されたパラメタが埋め込まれている．ただし，スポンジ境界の厚さによって吸収係数はスケーリングされる．

PMLは多くの場合について非常に高性能な吸収境界条件であるが，コントラストの大きな速度構造不連続や低速度層の存在などによって，数値不安定を起こすことがある．
`OpenSWPC`で採用したADE CFS-PMLはそのような不安定が起こりにくいとされているが，万一数値計算の不安定が発生した場合には，

  - 計算領域を少し平行移動してみる．`clon`と`clat`を変更するか，グリッドサイズ`nx`, `ny`を増減させる．
  - 極端な低速度層を`stabilize_pml`オプションを`.true.`にすることで排除してみる
  - 震源でのライズタイムを長くして高周波を抑える

などの工夫により改善する場合がある．Cerjanによる吸収境界条件は常に安定であるが，PMLと比べると境界における吸収性能は低くなる．

!!! Info "Parameters"

    **`abc_type`**
    : 吸収境界条件の種類．`’pml’`もしくは`’cerjan’`のどちらかを指定．

    **`na`**
    : 吸収境界領域のグリッド厚．通常10から20程度の値が用いられる．

    **`stabilize_pml`**
    : `.true.`のとき，低速度層を排除してPMLの安定化を試みる．ただしこのオプションの副作用として人工反射波の振幅は大きくなることがある．

    **`fullspace_mode`** (new in version 5)
    : `.true.`のとき，$z$軸の上部にも吸収境界条件を適用する．このオプションは通常は空気層のため必要ないが，地表面の存在しない全無限媒質のシミュレーションの際に有用であろう．
  
!!! Caution
    `fullspace_mode` は，Version 5.0.0 では2次元（P-SV, SH）コードでのみ有効である．3次元には近い将来実装される予定である．
    