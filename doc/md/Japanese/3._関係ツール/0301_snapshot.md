# スナップショット

## `read_snp.x` 

スナップショットは独自形式もしくは`NetCDF`形式のバイナリファイルであるが，いずれもプログラム`read_snp.x`によって可視化もしくは振幅データの抽出ができる．


``` bash
read_snp.x -i snapshotfile [-h] [-ppm|-bmp] [-pall] 
              [-mul var | -mul1 var -mul2 var ...] [-bin] [-asc] [-skip n]
```

  `-h`
  : スナップショットファイルに内包されているヘッダ情報を出力する．計算を実施した日時・計算タイトル・コード種別（3D/PSV/SH）・グリッド間隔・座標系などの情報が出力される．以下に例を示す．

    ``` txt
     $ ../bin/read_snp.x -i swpc_3d.xz.ps.snp -h

     [binary type]   : STREAMIO
     [code type]     : SWPC_3D
     [header version]:          3
     [title]         : swpc_3d
     [date generated]: 1408015126
                       2014-08-14T11-18-46
     [coordinate]    : xz
     [data type]     : ps
     [ns1]           :        256
     [ns2]           :        256
     [beg1]          :       -63.87500
     [beg2]          :        -9.87500
     [ds1]           :         0.25000
     [ds2]           :         0.25000
     [dt]            :         0.05000
     [na1]           :         20
     [na2]           :         20
     [nmed]          :          3
     [nsnp]          :          2
     [clon]          :       143.50000
     [clat]          :        42.00000
    ```

  `-ppm`, `-bmp`
  : それぞれppmもしくはbmp形式の画像を出力する．結果はそれぞれ`ppm`/`bmp`ディレクトリ（自動作成）に連番ファイルとして格納される．可視化対象が速度あるいは変位であれば，上下動と水平動をそれぞれ赤と緑で，P波・S波（div, rot）であればそれぞれの成分の絶対値を赤と緑で色分けして表示する．ただし，絶対値オプションが付加された場合にはGMTのカラーパレットhot相当の色で絶対値を可視化する．

!!! bug "BMP形式の制限"
      `bmp` は仕様により画素数によってうまく動かないことがある．`ppm`形式を推奨する．
      
  `-pall`
  : 吸収境界領域まで含めて可視化を行う（デフォルトでは切り落とす）

  `-mul`
  : 可視化する際に出力振幅をvar倍する．色の強さの調整をここで行う．`-mul1`, `-mul2`などを用いると，成分ごとの振幅の重みを個別に与えることができる．これにより，たとえばP波だけあるいは上下動だけというように，特定成分だけを切り出すことができる．

  `-abs`
  : 速度スナップショットに対してその絶対値を可視化する．P波・S波のスナップショットはもともとそれぞれの絶対値が出力されているので動作しない．

  `-bin`, `-asc`
  : 各時間ステップのスナップショットを単精度バイナリもしくはアスキーデータとしてbinもしくはascディレクトリに出力する．バイナリデータは`GMT`(`xyz2grd`など）から-bisオプションで直接読み込むことができる．

  `-skip n`
  : 最初の$n$スナップショットを読み飛ばす．

  `-notim` (after v5.1)
  : 可視化画像に経過時間をプロットしない．


## `diff_snp.x`

ふたつのスナップショットファイルの差を取り，同じフォーマットのスナップショットファイルに出力する．

``` bash
$ diff_snp.x snap1 snap2 diffile
```

出力ファイルのフォーマット（`NetCDF`もしくは独自バイナリ）は入力ファイルのフォーマットに依存する．


## `fs2grd.x`  

**New in v5.1**

`OpenSWPC`の地表面もしくは海面におけるスナップショットファイル`(title).(ob|fs).(typ).nc`は，NetCDF形式ファイルではあるものの，緯度経度方向に等間隔のデータではないため，GMTの`grdimage`ではそのままプロットできない．

`fs2grd.x`は，`OpenSWPC`内指定された緯度経度範囲と間隔で出力ファイルをリサンプルし，GMTで直接利用可能なgrd形式のデータを出力する．

``` bash
$ fs2grd.x -i input.nc -v variable_name 
           -R region -dlon delta_lon -dlat delta_lat 
```


  `-i`
  : `OpenSWPC`出力スナップショット（NetCDF形式）ファイル．地表面（`fs`）・海底面（`ob`）あるいは`xy`データであること．

  `-R` `lon0/lon1/lat0/lat1`
  : リサンプルデータを作る領域．経度方向の最小`lon0`と最大`lon1`，緯度方向の最小`lat0`と`lat1`を与える．
  記法はGMTの書式に準じるが，`-R`とオプションの値の間には空白が必要であることに注意．シミュレーション領域の外側を含んだ場合，そこはNaNで埋められる．

  `-dlon` delta_lon, `-dlat` delta_lat
  : 経度・緯度方向のグリッド間隔．この間隔で補間される．

  `-v` variable_name
  : 変数名．スナップショットに定義されている水平面2次元配列データであれば何でも良い．変数の一覧は`ncdump -h`コマンドで確認することができる．`Vx, Vy, Vz`や`div, rot_x, rot_y, rot_z`のような時間変化するデータは，時間ステップごとに分割したファイルが生成される．
